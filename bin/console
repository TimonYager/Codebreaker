#!/usr/bin/env ruby

require "bundler/setup"
require "codebreaker"

require_relative '../lib/codebreaker/game'

levels = ['e', 'm', 'h']

puts "Game 'Codebreaker'"

loop do
  puts "Select level:"
  puts "Press 'e' for easy   level"
  puts "Press 'm' for medium level"
  puts "Press 'h' for hard   level"

  loop do
    print "Your choise: "
    input = gets.chomp
    next unless levels.include?(input)

    case input
    when 'e'
      @game = Game.new('easy')
    when 'm'
      @game = Game.new('medium')
    when 'h'
      @game = Game.new('hard')
    end
    break
  end

  @game.start

  puts "You must break 4 number code. You have #{@game.chances} chances."
  puts "You can press 'e' to exit the game."
  puts "You can press 'h' to get a hint (only once)."

  until @game.over? do
    print "Enter your guess (#{@game.chances} chances left): "
    input = gets.chomp

    case input 
    when 'h'
      puts "Secret code include number #{@game.hint}"
    when 'e'
      puts "See you next time."
      exit
    else
      answer = @game.guess(input)
      puts "Answer: #{answer}"
      break if @game.won?
    end
  end

  puts "Game is over."
  if @game.won? 
    @game.count_up_score
    puts "You won. Total score: #{@game.score}"
  else
    puts "You lose."
  end

  print "Enter your name: "
  input = gets.chomp
  @game.save_result(input)
  puts "Result is saved."

  puts "Press 'a' if you want to play again."
  puts "Press 'e' if you want to exit."
  print "Your choise: "
  input = gets.chomp

  case input
  when 'a'
    next
  when 'e'
    exit
  else
    puts "Wrong input. Game is over."
    exit
  end
end